kind: Secret
apiVersion: v1
metadata:
  name: alertmanager-main
  namespace: openshift-monitoring
  labels:
    app.kubernetes.io/component: alert-router
    app.kubernetes.io/instance: main
    app.kubernetes.io/name: alertmanager
    app.kubernetes.io/part-of: openshift-monitoring
type: Opaque
stringdata:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m
      smtp_from: alertmanager@homelab.csfreak.com
      smtp_smarthost: 'smtp.smtp-relay.svc.cluster.local:25'
      smtp_hello: localhost
      smtp_require_tls: false
    inhibit_rules:
      - equal:
          - namespace
          - alertname
        source_matchers:
          - severity = critical
        target_matchers:
          - severity =~ warning|info
      - equal:
          - namespace
          - alertname
        source_matchers:
          - severity = warning
        target_matchers:
          - severity = info
      - equal:
          - namespace
        source_matchers:
          - alertname = InfoInhibitor
        target_matchers:
          - severity = info
    receivers:
      - name: Critical
        email_configs:
          - to: homelab@csfreak.com
            smarthost: 'smtp.tools-smtp-relay.svc.cluster.local:25'
      - name: Default
    route:
      group_by:
        - namespace
      group_interval: 5m
      group_wait: 30s
      receiver: Default
      repeat_interval: 12h
      routes:
        - receiver: null
          continue: false
          matchers:
          - alertname =~ Certificate(?:Approaching)|(?:IsAboutTo)Expir(?:e)|(?:action)
          - job = cert-utils-operator-controller-manager-metrics-service
          - name = pprof-cert
          - namespace = cert-utils-operator
          - service = cert-utils-operator-controller-manager-metrics-service
          - container = kube-rbac-proxy
        - receiver: Critical
          matchers:
            - severity = critical
