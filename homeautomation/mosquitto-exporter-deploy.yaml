apiVersion: apps/v1
kind: Deployment
metadata:
  name: mosquitto-exporter
  namespace: homeautomation
  annotations:
    app.kubernetes.io/component: mosquitto-exporter
    app.kubernetes.io/instance: mosquitto-exporter
    app.kubernetes.io/part-of: mosquitto-exporter
    image.openshift.io/triggers: >-
      [{"from":{"kind":"ImageStreamTag","name":"mosquitto-exporter:latest"},"fieldPath":"spec.template.spec.containers[?(@.name==\"mosquitto-exporter\")].image"}]
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      deployment: mosquitto-exporter
  template:
    metadata:
      labels:
        deployment: mosquitto-exporter
      annotations:
        app.kubernetes.io/component: mosquitto-exporter
        app.kubernetes.io/instance: mosquitto-exporter
        app.kubernetes.io/part-of: mosquitto-exporter
        alpha.image.policy.openshift.io/resolve-names: "*"
    spec:
      containers:
        - name: mosquitto-exporter
          image: mosquitto-exporter:latest
          envFrom:
            - secretRef:
                name: mosquitto-exporter-secret
              prefix: MOSQUITTO_
          args:
            -  --endpoint
            - $(MOSQUITTO_PORT)
          resources:
            limits:
              memory: 50M
              cpu: 10m
            requests:
              memory: 20M
              cpu: 2m
          ports:
            - name: metrics
              containerPort: 9234
              protocol: TCP
